<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prompt Timeline - {{DATE_RANGE}}</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <link rel="stylesheet" href="/prompt_timeline.css">
    <style>
    </style>
</head>
<body>
    <div id="timeline-container">
        <div id="header">
            <div class="header-row">
                <h1>Prompt Timeline</h1>
                <div class="controls">
                    <button class="zoom-btn" onclick="showCalendar()" title="Calendar view">üìÖ</button>
                    <div class="control-group">
                        <span class="control-label">Date:</span>
                        <button class="date-nav-btn" onclick="changeDate(-1)" title="Previous day">‚Üê</button>
                        <input type="date" id="date-input" value="{{CURRENT_DATE}}" onchange="onDateChange(this.value)">
                        <button class="date-nav-btn" onclick="changeDate(1)" title="Next day">‚Üí</button>
                    </div>
                    <div class="control-group">
                        <span class="control-label">Zoom:</span>
                        <button class="zoom-btn" onclick="zoomOut()" title="Zoom out">‚àí</button>
                        <span id="zoom-level-display">100%</span>
                        <button class="zoom-btn" onclick="zoomIn()" title="Zoom in">+</button>
                    </div>
                    <button class="zoom-btn" id="reorder-btn" onclick="refreshTimeline()" title="Sort projects alphabetically">
                        Sort A-Z
                        <span id="project-count-badge" style="margin-left: 4px; color: white; border-radius: 10px; padding: 2px 6px; font-size: 10px; font-weight: bold;"></span>
                    </button>
                    <button class="zoom-btn" id="select-btn" onclick="toggleSelection()" title="Select prompts (drag to select) ‚Ä¢ Press S">‚¨ö Select</button>
                    <div class="actions-group">
                        <button class="zoom-btn" id="export-btn" onclick="exportSelected()" title="Export selected to CSV" style="display:none;">üì• CSV</button>
                        <button class="zoom-btn" id="animate-theater-btn" onclick="animateTheater()" title="Theater mode - 2 minute animation" style="display:none;">üé¨ Theater</button>
                        <button class="zoom-btn" id="animate-10x-btn" onclick="animate10x()" title="Quick preview - 10x speed" style="display:none;">‚ñ∂ 10x</button>
                        <button class="zoom-btn" id="animate-crawl-btn" onclick="animateCrawl()" title="Opening crawl - scrolling text" style="display:none;">‚≠ê Crawl</button>
                        <span id="selection-count" style="display:none; margin-left: 8px; color: #888; font-size: 12px;"></span>
                    </div>
                </div>
            </div>
            <div class="header-row" style="margin-top: 5px;">
                <div class="controls">
                    <div class="control-group">
                        <span class="control-label" style="color: #888;">Viewing:</span>
                        <span id="visible-range-display" style="color: #aaa; font-size: 12px; font-family: monospace; white-space: nowrap;">Loading...</span>
                    </div>
                    <div class="control-group">
                        <span class="control-label">Project:</span>
                        <select id="project-filter" onchange="filterByProject(this.value)">
                            <option value="">All Projects</option>
                        </select>
                    </div>
                    <div class="control-group">
                        <span class="control-label">Show:</span>
                        <select id="max-projects" onchange="setMaxVisibleProjects(parseInt(this.value))">
                            <option value="999">All</option>
                            <option value="20">20 projects</option>
                            <option value="15">15 projects</option>
                            <option value="10">10 projects</option>
                            <option value="5">5 projects</option>
                            <option value="3">3 projects</option>
                            <option value="2">2 projects</option>
                        </select>
                    </div>
                </div>
            </div>
            <div id="stats">{{STATS}}</div>
            <div class="zoom-help">Vertical scroll through projects ‚Ä¢ Click and drag to pan ‚Ä¢ Pinch to zoom ‚Ä¢ Click dots for details ‚Ä¢ Keys: S (select) = (zoom in) - (zoom out)</div>
            <div class="legend">
                <div class="legend-item">
                    <div class="legend-dot" style="background: #27ae60"></div>
                    <span>High (4-5 ‚òÖ)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-dot" style="background: #f39c12"></div>
                    <span>Medium (3 ‚òÖ)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-dot" style="background: #e74c3c"></div>
                    <span>Low (1-2 ‚òÖ)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-dot" style="background: #666"></div>
                    <span>Unrated</span>
                </div>
            </div>
        </div>
        <div id="timeline-scroll-container">
            <svg id="timeline-svg"></svg>
        </div>
    </div>

    <div id="side-panel">
        <div class="panel-content">
            <div class="panel-header">
                <div></div>
                <button class="close-btn" onclick="closePanel()">&times;</button>
            </div>
            <div id="panel-body"></div>
        </div>
    </div>

    <div class="tooltip-d3" id="tooltip"></div>
    <div id="save-status" class="save-status">Rating saved ‚úì</div>

    <div id="theater-mode" class="theater-mode" tabindex="0" onclick="event.target.id === 'theater-mode' && exitTheaterMode()">
        <div class="theater-controls">
            <button class="theater-btn" onclick="exitTheaterMode()">‚Üê Go Back</button>
        </div>
        <div class="theater-prompt-display" id="theater-prompt">
            <div class="theater-prompt-time" id="theater-time"></div>
            <div class="theater-prompt-project" id="theater-project"></div>
            <div class="theater-prompt-text" id="theater-text"></div>
            <div class="theater-rating" id="theater-rating">
                <button class="theater-rating-btn" onclick="rateTheaterPrompt(1)">1</button>
                <button class="theater-rating-btn" onclick="rateTheaterPrompt(2)">2</button>
                <button class="theater-rating-btn" onclick="rateTheaterPrompt(3)">3</button>
                <button class="theater-rating-btn" onclick="rateTheaterPrompt(4)">4</button>
                <button class="theater-rating-btn" onclick="rateTheaterPrompt(5)">5</button>
            </div>
        </div>
        <div class="theater-progress" id="theater-progress"></div>
        <div class="theater-timeline" id="theater-timeline"></div>
    </div>

    <div id="crawl-mode" class="crawl-mode" tabindex="0">
        <canvas id="starfield"></canvas>
        <div class="theater-controls">
            <button class="theater-btn" onclick="exitCrawlMode()">‚Üê Back</button>
        </div>
        <div class="crawl-clock" id="crawl-clock"></div>
        <div class="crawl-container">
            <div class="crawl-text" id="crawl-text"></div>
        </div>
    </div>

    <div id="calendar-view" class="calendar-view">
        <div class="calendar-header">
            <h2 class="calendar-title">Prompt Calendar</h2>
            <button class="calendar-close" onclick="closeCalendar()">‚úï Close</button>
        </div>
        <div class="calendar-nav">
            <button onclick="changeCalendarMonth(-1)">‚Üê Previous</button>
            <span id="calendar-month-year"></span>
            <button onclick="changeCalendarMonth(1)">Next ‚Üí</button>
        </div>
        <div class="calendar-grid" id="calendar-grid"></div>
        <div class="calendar-legend">
            <div class="legend-title">Prompt Density</div>
            <div class="legend-scale">
                <span>Low</span>
                <div class="legend-gradient"></div>
                <span>High</span>
            </div>
        </div>
    </div>

    <script>
        let prompts = {{PROMPTS_DATA}};
        let currentPrompt = null;
        let currentDate = '{{CURRENT_DATE}}';
    </script>
    <script src="/prompt_timeline.js"></script>
</body>
</html>
